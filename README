計画停電時間検索の運用ファイル一式＠nanakochi123456版を
ご利用いただきありがとうございます。

ぜひサイトの強化にご参加ください。

元提供者:中島昌彦(http://twitter.com/mnakajim)
改造者：ななこっち★(http://twitter.com/nanakochi123456)
画像提供：渡邊 春菜さん(http://twitter.com//watanabe_haruna)

ファイルリスト
　all.all データファイル
　area.cgi 検索スクリプト
  common.pl(付随ファイル)
　counter.pl(付属ファイル)
　fatlib.pl(付属ファイル)
  timetable.txt(付随ファイル)
  runtable.txt(付随ファイル)
　yubin.csv(郵便番号データファイル　該当地域のみ）
  index.cgi(サイトトップのHTMLのCGI)
　.htaccess(index.cgiに誘導する)
  update.cgi(自動アップデート用のスクリプト）
　pc.html(PC用出力ファイル）
　mobile.html(携帯用出力ファイル）
　mobile_update.html(携帯用更新履歴出力ファイル）
　english.html(英語用出力ファイル）
　english_mobile.html(英語用携帯出力ファイル）
　area_jp.html(出力結果の日本語のPC版）
　area_en.html(出力結果の英語語のPC版）
　area_jp_m.html(出力結果の日本語の携帯版）
　area_en_m.html(出力結果の英語語の携帯版）
　area_jp_rss.xml(出力結果の日本語のRSS版 - このままでは通りません）
　area_en_rss.xml(出力結果の英語語のRSS版 - このままでは通りません）
　update.cgi(http://power.daiba.cx/ から自動アップデートするスクリプト)
　title_s.jpg(渡邊 春菜さん作のTOPページの上の画像）
　twitter_tag.jpg(渡邊 春菜さん作のtwiiter タグの画像）
　title_eng.jpg(渡邊 春菜さん作の英語版TOPページ上の画像）
　kekka.jpg(渡邊 春菜さん作の検索結果画面の画像)
　kekka_eng.jpg(渡邊 春菜さん作の英語版検索結果の画像)

ディレクトリ
　counter/ 以下
　アクセスカウンター（検索時のみカウント、表示は ?comm=ver のみ)
　もし、ユーザー権限がないサーバーであれば、chmod 777 counter をして下さい。
　counter.txt(カウンター本体 - 自動生成)
　counter.lk(カウンター用リネームロックファイル flock が使用できない時のみ自動生成)

ファイルが足りない、壊れて動かないというときはご連絡ください。

動作スクリプトの中には、みなさんからいただいたアイディアと知識が含まれています。
all.allは、東京電力が計画停電エリアとして開示しているExcelデータをテキストファイルに変更したもの、及び、東北電力が計画停電予定エリアとして開示しているPDFデータをテキストファイルに変換したものを使用しています。

yubin.csvは、日本郵便が正式に提供している郵便番号データベース(CSV)を使用しています。

あると良いかもしれないモジュール
　GD::Barcode
　QRコードを表示します。

その他、header.html、及び、footer.html になにか記述すれば、
PC（日本語）のみ自動的にその内容が挿入されます。

update.cgi において、
.htaccess.org に オリジナルの .htaccess の内容を記述しておけば、
.htaccess が実質上書きされずに再コピーされます。

update.cgi のcrontab においての自動アップデートについて
当サーバー(http://power.daiba.cx/) は帯域はあまり大きくないものの（共有100M)
アクセスが集中しても大丈夫なサーバー設計をしておりますので、1～2時間おきの
アップデートをしても大丈夫だと思います。

しかしながら、crontab は shell (telnet or ssh) が使えるサーバーでないと設定が
非常に難しいです。

まず、運営サーバー側でshellが使用できるのであれば、以下のように設定してみて下さい。

$ crontab -e

(vi エディタが立ち上がる)
全くの空欄なら、a キーを押す
コメント行等があれば、↓キー等（他のホットキーは忘れました；；）で、適当に
一番下に移動する。

a キーを押す

0 * * * * /path/update.cgi >/dev/null 2>/dev/null

できれば、この 0 の数字は変えていただければと思います（0～59の範囲で）

その後、ESC を(念のため２回）押して、:wq! Enter で保存されます。

自家サーバーからupdate.cgiを実行する方

crontab の使用方法は割合します。

0 * * * * /usr/local/bin/wget -O /dev/null http://your.power.mirror.site/update.cgi 2>/dev/null

p.s. /usr/bin の可能性もありますので、which コマンドで確認して下さい。


ご利用の際は、CCに準拠してご利用ください。
* 表示+継承  クレジット表示と改変時以後もクレジット表示の継承をお願いします。改変以降の扱いは、改変者の意図におまかせします。

中島昌彦(http://twitter.com/mnakajim)
計画停電時間検索ツール(http://bizoole.com/power/)

なお、当方のクレジット表示は不要です。
